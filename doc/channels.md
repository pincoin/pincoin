# 개요

1. 웹소켓, Redis를 이용한 채널 관리
2. Django는 동기, channels는 웹소켓 비동기 처리
3. 파이썬 3.5 이상 필요
4. ASGI(Async Server Gateway Interface) 프로토콜

# ASGI 비동기 요청 웹소켓 이벤트
* connect
* send
* receive
* disconnect

웹소켓을 클라이언트로 여는 open은 channels에서 제공하지 않는다.

# 소비자(consumer)
접속마다 개별 소비자 인스턴스가 만들어진다. 그리고 각각 고유한 채널 이름이 자동으로 만들어진다.

# 채널 레이어, 그룹

## 채널
채널은 메시지를 받는 우편함이다. 채널은 이름이 있어 그 이름을 알면 누구나 채널에 메시지를 보낼 수 있다.

## 그룹
그룹은 여러 채널의 묶음이다. 그룹도 이름이 있어 그 이름을 알면 그룹에 채널을 추가하거나 삭제할 수 있다.

그룹 안의 모든 채널에 메시지를 보낼 수도 있다. 

## 채널 레이어
모든 소비자는 유일한 채널 이름을 자동으로 받고 채널 레이어를 통해 의사소통할 수 있다.

채팅 방 안에 소비자들이 서로 대화하려면 방 이름을 토대로 그룹에 채널을 추가해야 한다.

그리고 나서 채팅 소비자들은 같은 방안의 다른 소비자들에게 채널 레이어를 통해 메시지를 보낸다.

소비자 인스턴스는 자신의 고유한 채널 이름을 갖고 있고 채널 레이어를 통해서만 통신할 수 있다.

같은 채팅 방 안에 여러 소비자 인스턴스가 서로 채팅하려면 각 소비자는 자신의 채널을 방 그룹에 추가한다. 그래서 소비자가 같은 방의 모든 소비자에게 메시지를 보내도록 할 수 있다.

## 채널 레이어, 그룹 함수
```
async_to_sync(self.channel_layer.group_add(그룹이름, 채널이름))
```
그룹에 소비자의 채널을 추가한다.

```
async_to_sync(self.channel_layer.group_discard(그룹이름, 채널이름))
```
그룹에서 소비자의 채널을 버린다.

```
async_to_sync(self.channel_layer.group_send(이벤트))
```
그룹에게 이벤트를 보낸다.

이벤트의 `type` 키 값은 이벤트를 수신하는 소비자가 호출해야 하는 메소드 이름이다.
